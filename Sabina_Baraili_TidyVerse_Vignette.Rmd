---
title: "Exploring Netflix Movies Dataset with TidyVerse"
author: "Sabina Baraili"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
  pdf_document:
    latex_engine: xelatex
    toc: true
  html_document:
    toc: true
    number_sections: true
---

```{r setup, include=FALSE}
# Load required libraries
library(tidyverse)
library(readr)
theme_set(theme_minimal())
```

# Introduction

The purpose of this vignette is to demonstrate how to use **TidyVerse** packages - mainly **`dplyr`**, **`ggplot2`**, and **`tidyr`** - for data cleaning, manipulation, and visualization using a real-world dataset.

We will explore the **Netflix Movies and TV Shows dataset** from Kaggle, which includes details such as title, type, country, release year, and genre.

Dataset link: [Netflix Titles (Kaggle)](https://www.kaggle.com/datasets/shivamb/netflix-shows)

---

# Load and Inspect the Dataset

```{r load-data}
# Load dataset (make sure netflix_titles.csv is saved in your working directory)
netflix <- read_csv("netflix_titles.csv")

# View structure and sample data
glimpse(netflix)
head(netflix)
```

---

# Clean and Prepare the Data

We’ll filter only **Movies** and remove records with missing values in important columns like `release_year` and `country`.

```{r clean-data}
netflix_clean <- netflix %>%
  filter(type == "Movie") %>%
  drop_na(release_year, country)

# Quick check of the cleaned data
summary(netflix_clean)
```

---

# Top Movie-Producing Countries

Let’s find the **top 10 countries** that have produced the most Netflix movies using `dplyr::count()`.

```{r summarize-country}
top_countries <- netflix_clean %>%
  count(country, sort = TRUE) %>%
  head(10)

top_countries
```

---

# Visualization - Top 10 Countries by Movie Count

We’ll visualize the results using a horizontal bar chart with `ggplot2`.

```{r plot-country}
ggplot(top_countries, aes(x = reorder(country, n), y = n)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(
    title = "Top 10 Countries by Number of Netflix Movies",
    x = "Country",
    y = "Number of Movies"
  ) +
  theme_minimal()
```

---

# Movie Release Trend Over the Years

Here, we’ll analyze how Netflix movie releases have changed over time.

```{r plot-year}
movies_by_year <- netflix_clean %>%
  group_by(release_year) %>%
  summarise(total_movies = n())

ggplot(movies_by_year, aes(release_year, total_movies)) +
  geom_line(color = "tomato", linewidth = 1.1) +
  geom_point(color = "darkred", size = 2) +
  labs(
    title = "Netflix Movie Releases Over the Years",
    x = "Release Year",
    y = "Number of Movies Released"
  ) +
  theme_light()
```

---

# Most Common Genres on Netflix

Each title can have multiple genres separated by commas.  
We’ll use `tidyr::separate_rows()` to split them and count the most frequent genres.

```{r genre-analysis}
genre_data <- netflix_clean %>%
  separate_rows(listed_in, sep = ", ") %>%
  count(listed_in, sort = TRUE) %>%
  head(10)

genre_data
```

```{r plot-genre}
ggplot(genre_data, aes(x = reorder(listed_in, n), y = n)) +
  geom_col(fill = "orchid") +
  coord_flip() +
  labs(
    title = "Top 10 Most Common Netflix Genres",
    x = "Genre",
    y = "Count"
  ) +
  theme_minimal()
```

---

# Summary

This vignette demonstrates how to:
- Use **`dplyr`** for data manipulation (`filter`, `count`, `group_by`, `summarise`).
- Use **`tidyr`** to reshape data with `separate_rows`.
- Use **`ggplot2`** to visualize results in bar and line charts.

---

# References

- Kaggle Netflix Dataset: <https://www.kaggle.com/datasets/shivamb/netflix-shows>  
- TidyVerse Documentation: <https://www.tidyverse.org/packages/>

--- 

# TidyVerse EXTEND Assignment: extended by Catherine Dube

## Additional Analysis: Movie Duration and Genre Patterns

In this section, I extend the original vignette by exploring how movie duration varies across genres, i.e. variable `listed_in`. Netflix titles often list multiple genres for a single movie, so I'll start by tidying the data using separate_rows(), then compute summary statistics, and finally visualize the results.

```{r extend-data}
# Clean and prepare dataset - expanded for genre

duration_genre_df <- netflix_clean %>%
  separate_rows(listed_in, sep = ", ") %>%  # expand multi-genre rows
  filter(!is.na(duration)) %>% # keep only records with duration
  mutate(
    duration_min = parse_number(duration) # convert "90 min" → 90
  )
```

## Average Movie Duration by Genre

Here I'm getting the mean movie length for each genre and identifying which genres have the longest or shortest typical runtimes.

```{r mean-movie-length-per-genre}
genre_duration_summary <- duration_genre_df %>%
  group_by(listed_in) %>%
  summarise(
    avg_duration = mean(duration_min, na.rm = TRUE),
    count_movies = n()
  ) %>%
  filter(count_movies >= 20) %>%           # keep only genres with enough data
  arrange(desc(avg_duration))

head(genre_duration_summary)
```

## Visualization: Genres With the Longest Average Duration

This bar chart highlights the top 10 genres with the longest average runtimes.

```{r runtime-bar}
genre_duration_top10 <- genre_duration_summary %>%
slice_max(avg_duration, n = 10)

ggplot(genre_duration_top10,
aes(x = reorder(listed_in, avg_duration), y = avg_duration)) +
geom_col(fill = "darkseagreen3") +
coord_flip() +
labs(
  title = "Top 10 Genres by Average Movie Duration",
  x = "Genre",
  y = "Average Duration (minutes)"
) +
theme_minimal()

```

Classic movies have the longest average duration nearing 120 minutes!

## Movie Duration Distribution

Finally to get an idea of the variability of the runtimes, here is the distribution of movie durations.  

```{r duration-distribution}
# Using netflix_clean again here bc my dataframe above duplicates lines for movies in mult. genres
duration_movies <- netflix_clean %>%
  filter(!is.na(duration)) %>%
  mutate(duration_min = parse_number(duration))

ggplot(duration_movies, aes(duration_min)) +
  geom_density(fill = "lightcoral", alpha = 0.6) +
  labs(
    title = "Distribution of Netflix Movie Durations",
    x = "Runtime (minutes)",
    y = "Density"
  ) +
  theme_minimal()

```

The average movie in the data set runs a little under 100 minutes long. 

## Summary from Tidyverse EXTEND

This extended analysis demonstrates additional TidyVerse skills, including:

* Using separate_rows() and parse_number() to clean multi-valued fields
* Grouping and summarizing movie durations by genre
* Creating both bar charts and density plots using ggplot2
* Employing tidy data principles to improve interpretability

These additions introduced a new angle to the exploration on the Netflix dataset! It also revealed to us that while the average movie runtims is jsut under 100 minutes, Classic movies average just under 120 minutes, which is good to know the next time I pick a movie.
